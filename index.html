<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A personal book review website showcasing my favorite books and ratings.">
    <meta name="keywords" content="book reviews, reading, books, ratings">
    <title>My Book Reviews</title>
    <link rel="icon" type="image/png" href="favicon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-papovpS4kZT1Vd1cV0E+X+gK+pH0dR7pb5sZYZkJ56jSx6k71e4BxoEAnYMBfr3GKxjpzjI3bC1aL4HgWop3kQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        @font-face {
            font-family: 'Roboto Mono';
            src: url('font.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }

        body {
            background-color: #f4f4f4;
            color: #333;
            font-family: 'Roboto Mono', monospace;
            text-align: center;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }

        h1 {
            color: #ff0000;
            margin-bottom: 20px;
            animation: fadeInDown 1s ease;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        #reading-and-stats-container {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto 40px auto;
            padding: 20px;
            box-sizing: border-box;
            flex-wrap: wrap;
            animation: fadeIn 1s ease;
        }

        #currently-reading-container {
            background-color: #fffbcc;
            border: 2px solid #ffcc00;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            flex: 2;
            padding: 20px;
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            gap: 20px;
            position: relative;
            z-index: 10;
            min-width: 300px;
            box-sizing: border-box;
            max-width: 600px; 
            transition: transform 0.3s;
        }

        #currently-reading-container:hover {
            transform: translateY(-5px);
        }

        #currently-reading-container img {
            width: 200px;
            height: auto;
            border-radius: 5px;
            object-fit: cover;
            loading: lazy; 
            transition: transform 0.3s;
        }

        #currently-reading-container img:hover {
            transform: scale(1.05);
        }

        #currently-reading-details {
            text-align: left;
            flex: 1;
            word-wrap: break-word; 
            animation: fadeIn 1s ease;
        }

        #currently-reading-details h2 {
            margin: 0 0 10px 0;
            font-size: 1.8em;
            color: #c01919;
            word-break: break-word; 
        }

        #currently-reading-details .author {
            font-size: 1.1em;
            color: #555;
            margin-bottom: 10px;
            word-break: break-word;
        }

        #currently-reading-details .start-date {
            font-size: 1em;
            color: #777;
            margin-bottom: 15px;
        }

        #currently-reading-details .status {
            font-size: 1em;
            color: #333;
            margin-bottom: 15px;
        }

        #currently-reading-details .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-start;
            animation: fadeIn 1s ease;
        }

        .world-of-books-button,
        .goodreads-button {
            padding: 10px 12px;
            background-color: #ffcc00;
            color: #333;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            transition: background-color 0.3s, transform 0.3s;
            flex: 1;
            text-align: center;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .world-of-books-button i,
        .goodreads-button i {
            font-size: 1em;
        }

        .world-of-books-button:hover,
        .goodreads-button:hover {
            background-color: #e6b800;
            transform: scale(1.05);
        }

        #stats-container {
            background-color: #e6f7ff;
            border: 2px solid #1890ff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: left;
            flex: 1;
            min-width: 300px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            animation: fadeIn 1s ease;
        }

        #stats-container h3 {
            margin-top: 0;
            color: #1890ff;
        }

        #stats-container p {
            margin: 10px 0;
            font-size: 0.95em;
            color: #333;
        }

        #stats-container .label {
            color: #1890ff;
            font-weight: bold;
        }

        #stats-container .value {
            color: #555;
        }

        #stats-container ol {
            padding-left: 20px;
            margin: 5px 0 0 0;
        }

        #stats-container ol li {
            margin-bottom: 5px;
            color: #555;
        }

        .stats-section ol {
            padding-left: 30px;
            margin: 0;
        }

        .stats-section ol li {
            margin-bottom: 5px;
            color: #555;
            font-size: 0.95em;
            line-height: 1.4em;
        }

        .star {
            color: #ffcc00;
            font-size: 1em;
            margin-right: 2px;
        }

        .star.empty {
            color: #ddd;
        }

        #books-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 0 auto;
            max-width: 1200px;
            padding: 20px;
            box-sizing: border-box;
            animation: fadeIn 1s ease;
        }

        .book {
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: left;
            position: relative;
            display: flex;
            flex-direction: column;
            min-height: 450px;
            max-width: 350px;
            margin: 0 auto;
            box-sizing: border-box;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .book:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .book img {
            width: 100%;
            height: auto;
            aspect-ratio: 2 / 3;
            border-radius: 5px;
            object-fit: cover;
            margin-bottom: 15px;
            loading: lazy; 
            transition: transform 0.3s;
        }

        .book img:hover {
            transform: scale(1.05);
        }

        .book h2 {
            margin: 10px 0 10px 0;
            font-size: 1.3em;
            color: #ff0000;
            height: 3em;
            overflow: hidden;
            word-break: break-word;
            transition: color 0.3s;
        }

        .book:hover h2 {
            color: #c01919;
        }

        .author,
        .date-read {
            font-size: 0.95em;
            color: #c01919;
            margin-bottom: 10px;
            height: 1.2em;
            overflow: hidden;
            word-break: break-word; 
        }

        .rating-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .rating {
            font-size: 1.2em;
            color: #ff0000;
            display: flex;
        }

        .rating .star {
            font-size: 1.3em;
            color: #ff0000;
            margin: 0 1px;
        }

        .rating .star-empty {
            color: #ddd;
        }

        .book p {
            font-size: 0.95em;
            color: #666;
            margin: 10px 0;
            flex-grow: 1;
            height: 4.5em;
            overflow: hidden;
        }

        .top-book-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ffcc00;
            color: #333;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.8em;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .footer {
            margin-top: 40px;
            font-size: 0.8em;
            color: #777;
        }

        .footer a {
            color: #ff0000;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        ::selection {
            background-color: #ff0000;
            color: #ffffff;
        }

        .search-container {
            margin-bottom: 20px;
            animation: fadeIn 1s ease;
        }

        .search-input {
            padding: 10px;
            font-size: 1em;
            width: 100%;
            max-width: 300px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .search-input:focus {
            border-color: #ff0000;
            box-shadow: 0 0 5px rgba(255, 0, 0, 0.5);
            outline: none;
        }

        .filter-container {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            animation: fadeIn 1s ease;
        }

        .filter-container select {
            padding: 10px;
            font-size: 1em;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .filter-container select:focus {
            border-color: #1890ff;
            box-shadow: 0 0 5px rgba(24, 144, 255, 0.5);
            outline: none;
        }

        .filter-container button {
            padding: 10px 15px;
            font-size: 1em;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            background-color: #f4f4f4;
            transition: background-color 0.3s, transform 0.3s;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .filter-container button:hover {
            background-color: #ddd;
            transform: scale(1.05);
        }

        .filter-container button.active {
            background-color: #ddd;
        }

        .filter-container button.want-to-read-active {
            background-color: #ffcc00;
            color: #333;
        }

        .pagination {
            margin: 20px 0;
            display: flex;
            justify-content: center;
            gap: 5px;
            animation: fadeIn 1s ease;
        }

        .pagination button {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f4f4f4;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
            box-sizing: border-box;
        }

        .pagination button.active,
        .pagination button:hover {
            background-color: #ddd;
            transform: scale(1.05);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            animation: fadeIn 1s ease;
        }

        @media (max-width: 1024px) {
        }

        @media (max-width: 767px) {
            #currently-reading-container {
                flex-direction: column;
                align-items: center;
                text-align: center; 
            }

            #currently-reading-details {
                text-align: center; 
            }

            #books-container {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 10px;
                padding: 10px;
            }

            .book {
                padding: 15px;
                min-height: 350px;
                max-width: 100%;
            }

            .book img {
                width: 100%;
                height: auto;
                aspect-ratio: 2 / 3;
                margin-bottom: 10px;
            }

            .book h2 {
                font-size: 1.1em;
                height: auto; 
                overflow: visible;
                word-break: break-word; 
            }

            .author,
            .date-read {
                font-size: 0.9em;
                margin-bottom: 8px;
                height: auto; 
                overflow: visible;
                word-break: break-word; 
            }

            .book p {
                font-size: 0.9em;
                margin: 8px 0;
                height: auto; 
                overflow: visible;
            }

            .rating .star {
                font-size: 1em;
            }

            .search-input {
                max-width: 100%;
            }

            .filter-container select,
            .filter-container button {
                max-width: 100%;
            }

            .action-buttons {
                flex-direction: column;
                gap: 8px;
            }

            .world-of-books-button,
            .goodreads-button {
                padding: 8px 10px;
                font-size: 0.8em;
            }

            .filter-container {
                flex-direction: column;
                gap: 8px;
            }
        }

        @media (max-width: 480px) {
            #books-container {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 8px;
                padding: 8px;
            }

            .book {
                padding: 10px;
                min-height: 320px;
            }

            .book img {
                aspect-ratio: 2 / 3;
                margin-bottom: 8px;
            }

            .book h2 {
                font-size: 1em;
                height: auto; 
                word-break: break-word; 
            }

            .author,
            .date-read {
                font-size: 0.8em;
                margin-bottom: 5px;
                height: auto;
                word-break: break-word; 
            }

            .book p {
                font-size: 0.85em;
                margin: 5px 0;
                height: auto; 
            }

            .rating .star {
                font-size: 0.95em;
            }

            .pagination button {
                padding: 8px 10px;
                font-size: 0.85em;
            }
        }

        .modal {
            display: none; 
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8); 
            animation: fadeIn 0.5s ease;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 800px;
            border-radius: 10px;
            position: relative;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close-modal {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-modal:hover,
        .close-modal:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-book-image {
            width: 100%;
            max-width: 300px;
            height: auto;
            border-radius: 5px;
            object-fit: cover;
            margin-bottom: 20px;
        }

        .modal-book-details {
            text-align: left;
        }

        .modal-book-details h2 {
            margin-top: 0;
            color: #ff0000;
        }

        .modal-book-details .author {
            font-size: 1.1em;
            color: #555;
            margin-bottom: 10px;
        }

        .modal-book-details .date-read {
            font-size: 1em;
            color: #777;
            margin-bottom: 15px;
        }

        .modal-book-details .rating {
            font-size: 1.2em;
            color: #ff0000;
            margin-bottom: 15px;
        }

        .modal-book-details .review {
            font-size: 1em;
            color: #666;
        }

        .modal-action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-action-buttons button {
            padding: 10px 12px;
            background-color: #ffcc00;
            color: #333;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            transition: background-color 0.3s, transform 0.3s;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .modal-action-buttons button:hover {
            background-color: #e6b800;
            transform: scale(1.05);
        }
    </style>
</head>

<body>
    <h1>The Books I Have Read</h1>

    <div id="reading-and-stats-container">
        <div id="currently-reading-container">
            <img src="" alt="Currently Reading Book" id="currently-reading-image" loading="lazy">
            <div id="currently-reading-details">
                <h2 id="currently-reading-title">Book Title</h2>
                <div class="author" id="currently-reading-author">by Author Name</div>
                <div class="start-date" id="currently-reading-start-date">Started on: YYYY-MM-DD</div>
                <div class="status">In Progress</div>
                <div class="action-buttons">
                    <button class="world-of-books-button" id="current-world-of-books-button">
                        <i class="fas fa-book"></i> View on World of Books
                    </button>
                    <button class="goodreads-button" id="current-goodreads-button">
                        <i class="fab fa-goodreads-g"></i> Show on Goodreads
                    </button>
                </div>
            </div>
        </div>

        <div id="stats-container">
            <h3>Statistics</h3>
            <p><span class="label">Total Read Books:</span> <span class="value" id="total-read-books">0</span></p>
            <p><span class="label">Books Read This Year:</span> <span class="value" id="books-read-this-year">0</span></p>
            <p><span class="label">Books You Will Read This Year (Estimated):</span> <span class="value"
                    id="projected-books">0</span></p>
            <p><span class="label">Average Rating:</span> <span class="value" id="average-rating">0</span>
                <span id="average-rating-stars"></span>
            </p>
            <div class="stats-section">
                <p><span class="label">Top 3 Authors:</span></p>
                <ol id="top-authors">
                    <li>Author 1 (0 books)</li>
                    <li>Author 2 (0 books)</li>
                    <li>Author 3 (0 books)</li>
                </ol>
            </div>
        </div>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Search for books, authors, or dates...">
    </div>

    <div class="filter-container">
        <select id="sortBy">
            <option value="title">Sort by Title</option>
            <option value="author">Sort by Author</option>
            <option value="dateRead" selected>Sort by Date Read</option>
            <option value="rating">Sort by Rating</option>
        </select>

        <button id="toggleSortOrder">
            <i class="fas fa-sort-amount-down"></i> Sort Order: Desc
        </button>
        <button id="toggleView" class="active">
            <i class="fas fa-list"></i> My Want to Read
        </button>
    </div>

    <div id="books-container">
    </div>

    <div class="pagination" id="pagination-container">
    </div>

    <div class="footer">
        <p>V.1.2<br>Run your own book website. You will find this project on GitHub <a href="https://github.com/Elytra15/book-website" target="_blank">https://github.com/Elytra15/book-website</a></p>
    </div>


    <div id="bookModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <img src="" alt="Book Image" class="modal-book-image" id="modal-book-image">
            <div class="modal-book-details">
                <h2 id="modal-book-title">Book Title</h2>
                <div class="author" id="modal-book-author">by Author Name</div>
                <div class="date-read" id="modal-book-date-read">Read on: YYYY-MM-DD</div>
                <div class="rating" id="modal-book-rating"></div>
                <div class="review" id="modal-book-review">Book review goes here...</div>
                <div class="modal-action-buttons">
                    <button id="modal-world-of-books-button">
                        <i class="fas fa-book"></i> View on World of Books
                    </button>
                    <button id="modal-goodreads-button">
                        <i class="fab fa-goodreads-g"></i> Show on Goodreads
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let sortDescending = true;
        let currentPage = 1;
        const booksPerPage = 20;
        let allBooksRead = [];
        let allBooksWantToRead = [];
        let currentView = 'read';
        let currentSortBy = 'dateRead';
        let currentSortOrder = 'desc';

        let currentlyReading = null;

        const readBooksURL = '';
        const wantToReadBooksURL = '';
        const currentlyReadingURL = '';

        const fetchReadBooks = () => {
            fetch(readBooksURL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok for read books.');
                    }
                    return response.json();
                })
                .then(books => {
                    allBooksRead = books;
                    calculateAndDisplayStats();
                    applySort();
                })
                .catch(error => console.error('Error fetching read books:', error));
        };

        const fetchWantToReadBooks = () => {
            fetch(wantToReadBooksURL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok for want to read books.');
                    }
                    return response.json();
                })
                .then(books => {
                    allBooksWantToRead = books;
                    if (currentView === 'wantToRead') {
                        applySort();
                    }
                })
                .catch(error => console.error('Error fetching want to read books:', error));
        };

        const fetchCurrentlyReading = () => {
            fetch(currentlyReadingURL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok for currently reading book.');
                    }
                    return response.json();
                })
                .then(book => {
                    currentlyReading = book;
                    displayCurrentlyReading();
                })
                .catch(error => {
                    console.error('Error fetching currently reading book:', error);
                    document.getElementById('currently-reading-container').style.display = 'none';
                });
        };

        const displayCurrentlyReading = () => {
            if (!currentlyReading || !currentlyReading.title) {
                document.getElementById('currently-reading-container').style.display = 'none';
                return;
            }

            const container = document.getElementById('currently-reading-container');
            container.style.display = 'flex';

            document.getElementById('currently-reading-image').src = currentlyReading.image;
            document.getElementById('currently-reading-image').alt = currentlyReading.title;
            document.getElementById('currently-reading-title').textContent = currentlyReading.title;
            document.getElementById('currently-reading-author').textContent = `by ${currentlyReading.author}`;
            document.getElementById('currently-reading-start-date').textContent = `Started on: ${currentlyReading.startDate}`;

            const goodreadsQuery = encodeURIComponent(currentlyReading.title);
            const goodreadsSearchURL = `https://www.goodreads.com/search?q=${goodreadsQuery}`;
            const goodreadsButton = document.getElementById('current-goodreads-button');
            goodreadsButton.addEventListener('click', () => {
                window.open(goodreadsSearchURL, '_blank');
            });

            const worldOfBooksQuery = encodeURIComponent(currentlyReading.title);
            const worldOfBooksSearchURL = `https://www.worldofbooks.com/en-gb/search?q=${worldOfBooksQuery}`;
            const worldOfBooksButton = document.getElementById('current-world-of-books-button');
            worldOfBooksButton.addEventListener('click', () => {
                window.open(worldOfBooksSearchURL, '_blank');
            });
        };

        const displayBooks = (books, view) => {
            const booksContainer = document.getElementById('books-container');
            booksContainer.innerHTML = '';

            const start = (currentPage - 1) * booksPerPage;
            const end = start + booksPerPage;
            const paginatedBooks = books.slice(start, end);

            paginatedBooks.forEach(book => {
                const bookElement = document.createElement('div');
                bookElement.className = 'book';

                let reviewContent = '';
                let authorContent = '';
                let dateReadContent = '';

                if (view === 'read') {
                    reviewContent = book.review ? `<p>${book.review}</p>` : '<p>&nbsp;</p>';
                    authorContent = book.author ? `<div class="author">by ${book.author}</div>` : '<div class="author">&nbsp;</div>';
                    dateReadContent = book.dateRead ? `<div class="date-read">Read on: ${book.dateRead}</div>` : '<div class="date-read">&nbsp;</div>';
                } else {
                    authorContent = book.author ? `<div class="author">by ${book.author}</div>` : '<div class="author">&nbsp;</div>';
                    dateReadContent = '<div class="date-read">&nbsp;</div>';
                    reviewContent = '<p>&nbsp;</p>';
                }

                let starsHTML = '';
                if (view === 'read') {
                    let fullStars = '★'.repeat(book.rating);
                    let emptyStars = '☆'.repeat(5 - book.rating);
                    starsHTML = `
                        <div class="rating">
                            ${fullStars.split('').map(() => `<span class="star">★</span>`).join('')}
                            ${emptyStars.split('').map(() => `<span class="star empty">☆</span>`).join('')}
                        </div>
                    `;
                } else {
                    starsHTML = `<div class="rating" style="height: 1.2em;"></div>`;
                }

                const actionButtonsDiv = document.createElement('div');
                actionButtonsDiv.className = 'action-buttons';

                const goodreadsButton = document.createElement('button');
                goodreadsButton.className = 'goodreads-button';
                goodreadsButton.innerHTML = `<i class="fab fa-goodreads-g"></i> Show on Goodreads`;
                const goodreadsQuery = encodeURIComponent(book.title);
                const goodreadsSearchURL = `https://www.goodreads.com/search?q=${goodreadsQuery}`;
                goodreadsButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    window.open(goodreadsSearchURL, '_blank');
                });

                const worldOfBooksButton = document.createElement('button');
                worldOfBooksButton.className = 'world-of-books-button';
                worldOfBooksButton.innerHTML = `<i class="fas fa-book"></i> View on World of Books`;
                const worldOfBooksQuery = encodeURIComponent(book.title);
                const worldOfBooksSearchURL = `https://www.worldofbooks.com/en-gb/search?q=${worldOfBooksQuery}`;
                worldOfBooksButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    window.open(worldOfBooksSearchURL, '_blank');
                });

                actionButtonsDiv.appendChild(worldOfBooksButton);
                actionButtonsDiv.appendChild(goodreadsButton);

                bookElement.innerHTML = `
                    <img src="${book.image}" alt="${book.title}" loading="lazy">
                    <h2>${book.title}</h2>
                    ${authorContent}
                    ${dateReadContent}
                    ${starsHTML}
                    ${reviewContent}
                `;

                bookElement.appendChild(actionButtonsDiv);


                bookElement.addEventListener('click', () => {
                    openModal(book);
                });

                booksContainer.appendChild(bookElement);
            });

            updatePagination(books.length);
            adjustBookContainerLayout();
            window.scrollTo(0, 0);
        };

        const updatePagination = (totalBooks) => {
            const paginationContainer = document.getElementById('pagination-container');
            paginationContainer.innerHTML = '';

            const totalPages = Math.ceil(totalBooks / booksPerPage);

            for (let i = 1; i <= totalPages; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                button.className = i === currentPage ? 'active' : '';
                button.addEventListener('click', () => {
                    currentPage = i;
                    updateHash();
                    applySort();
                });
                paginationContainer.appendChild(button);
            }
        };

        const applySort = () => {
            let books = currentView === 'read' ? allBooksRead : allBooksWantToRead;

            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const sortBy = currentSortBy;
            const sortOrder = currentSortOrder;

            let filteredBooks = books.filter(book => {
                const title = book.title.toLowerCase();
                const author = book.author ? book.author.toLowerCase() : '';
                const dateRead = book.dateRead ? book.dateRead.toLowerCase() : '';

                let matchesSearch = title.includes(searchTerm) || author.includes(searchTerm) || dateRead.includes(searchTerm);
                return matchesSearch;
            });

            filteredBooks.sort((a, b) => {
                let aValue, bValue;

                if (sortBy === 'title') {
                    aValue = a.title.toLowerCase();
                    bValue = b.title.toLowerCase();
                } else if (sortBy === 'author') {
                    aValue = a.author ? a.author.toLowerCase() : '';
                    bValue = b.author ? b.author.toLowerCase() : '';
                } else if (sortBy === 'dateRead') {
                    aValue = a.dateRead ? new Date(a.dateRead) : new Date(0);
                    bValue = b.dateRead ? new Date(b.dateRead) : new Date(0);
                } else if (sortBy === 'rating') {
                    aValue = a.rating;
                    bValue = b.rating;
                }

                if (sortBy === 'dateRead' || sortBy === 'rating') {
                    if (aValue < bValue) return sortOrder === 'desc' ? 1 : -1;
                    if (aValue > bValue) return sortOrder === 'desc' ? -1 : 1;
                } else {
                    if (aValue < bValue) return sortOrder === 'desc' ? 1 : -1;
                    if (aValue > bValue) return sortOrder === 'desc' ? -1 : 1;
                }
                return 0;
            });

            displayBooks(filteredBooks, currentView);
        };

        document.getElementById('searchInput').addEventListener('input', function () {
            currentPage = 1;
            updateHash();
            applySort();
        });

        document.getElementById('sortBy').addEventListener('change', function () {
            currentSortBy = this.value;
            currentPage = 1;
            updateHash();
            applySort();
            window.scrollTo(0, 0);
        });

        document.getElementById('toggleSortOrder').addEventListener('click', function () {
            sortDescending = !sortDescending;
            currentSortOrder = sortDescending ? 'desc' : 'asc';
            this.innerHTML = `<i class="fas fa-sort-amount-${sortDescending ? 'down' : 'up'}"></i> Sort Order: ${sortDescending ? 'Desc' : 'Asc'}`;
            this.classList.toggle('active', sortDescending);
            currentPage = 1;
            updateHash();
            applySort();
            window.scrollTo(0, 0);
        });

        document.getElementById('toggleView').addEventListener('click', function () {
            currentView = currentView === 'read' ? 'wantToRead' : 'read';
            this.innerHTML = `<i class="fas fa-${currentView === 'read' ? 'list' : 'book'}"></i> ${currentView === 'read' ? 'My Want to Read' : 'My Read Books'}`;
            this.classList.toggle('want-to-read-active', currentView === 'wantToRead');
            currentPage = 1;
            updateHash();
            applySort();
        });

        const adjustBookContainerLayout = () => {
            const booksContainer = document.getElementById('books-container');
            const displayedBooks = booksContainer.children.length;

            if (displayedBooks === 1) {
                booksContainer.style.justifyItems = 'center';
            } else {
                booksContainer.style.justifyItems = 'stretch';
            }
        };

        const initializeCurrentlyReading = () => {
            fetchCurrentlyReading();
        };

        const parseHash = () => {
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);

            const view = params.get('view');
            const page = parseInt(params.get('page'), 10);
            const sortBy = params.get('sortBy');
            const sortOrder = params.get('sortOrder');

            if (view && (view === 'read' || view === 'wantToRead')) {
                currentView = view;
                document.getElementById('toggleView').innerHTML = `<i class="fas fa-${currentView === 'read' ? 'list' : 'book'}"></i> ${currentView === 'read' ? 'My Want to Read' : 'My Read Books'}`;
                document.getElementById('toggleView').classList.toggle('want-to-read-active', currentView === 'wantToRead');
            }

            if (!isNaN(page) && page > 0) {
                currentPage = page;
            }

            if (sortBy && ['title', 'author', 'dateRead', 'rating'].includes(sortBy)) {
                currentSortBy = sortBy;
                document.getElementById('sortBy').value = sortBy;
            }

            if (sortOrder && ['asc', 'desc'].includes(sortOrder)) {
                currentSortOrder = sortOrder;
                sortDescending = sortOrder === 'desc';
                document.getElementById('toggleSortOrder').innerHTML = `<i class="fas fa-sort-amount-${sortDescending ? 'down' : 'up'}"></i> Sort Order: ${sortDescending ? 'Desc' : 'Asc'}`;
                document.getElementById('toggleSortOrder').classList.toggle('active', sortDescending);
            } else {
                document.getElementById('toggleSortOrder').innerHTML = `<i class="fas fa-sort-amount-down"></i> Sort Order: ${sortDescending ? 'Desc' : 'Asc'}`;
            }
        };

        const updateHash = () => {
            const params = new URLSearchParams();
            params.set('view', currentView);
            params.set('page', currentPage);
            params.set('sortBy', currentSortBy);
            params.set('sortOrder', currentSortOrder);
            window.location.hash = params.toString();
        };

        window.addEventListener('hashchange', () => {
            parseHash();
            applySort();
        });

        const initializePage = () => {
            initializeCurrentlyReading();
            fetchReadBooks();
            fetchWantToReadBooks();
            parseHash();
        };

        document.addEventListener('DOMContentLoaded', initializePage);

        function calculateAndDisplayStats() {
            const totalReadBooks = allBooksRead.length;
            document.getElementById('total-read-books').textContent = totalReadBooks;

            const currentYear = new Date().getFullYear();
            const today = new Date();
            const firstDayOfYear = new Date(currentYear, 0, 1);
            const weeksPassed = getWeekNumber(today) - getWeekNumber(firstDayOfYear) + 1;
            const weeksPassedAdjusted = weeksPassed > 0 ? weeksPassed : 1;
            const booksReadThisYear = allBooksRead.filter(book => {
                if (book.dateRead) {
                    const bookDate = new Date(book.dateRead);
                    return bookDate.getFullYear() === currentYear && bookDate <= today;
                }
                return false;
            }).length;
            document.getElementById('books-read-this-year').textContent = booksReadThisYear;

            const totalWeeksInYear = 52;
            const remainingWeeks = totalWeeksInYear - weeksPassed;
            const averageBooksPerWeek = weeksPassedAdjusted > 0 ? (booksReadThisYear / weeksPassedAdjusted) : 0;
            const projectedBooks = Math.round(averageBooksPerWeek * remainingWeeks);
            document.getElementById('projected-books').textContent = projectedBooks;

            const ratedBooks = allBooksRead.filter(book => typeof book.rating === 'number');
            const totalRating = ratedBooks.reduce((sum, book) => sum + book.rating, 0);
            const averageRating = ratedBooks.length > 0 ? (totalRating / ratedBooks.length).toFixed(2) : '0';
            document.getElementById('average-rating').textContent = averageRating;

            const averageRatingStars = document.getElementById('average-rating-stars');
            averageRatingStars.innerHTML = generateStarRating(averageRating);

            const authorCount = {};
            allBooksRead.forEach(book => {
                if (book.author) {
                    authorCount[book.author] = (authorCount[book.author] || 0) + 1;
                }
            });

            const topAuthors = Object.entries(authorCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3);

            const topAuthorsList = document.getElementById('top-authors');
            topAuthorsList.innerHTML = '';
            topAuthors.forEach(([author, count]) => {
                const li = document.createElement('li');
                li.textContent = `${author} (${count} book${count > 1 ? 's' : ''})`;
                topAuthorsList.appendChild(li);
            });

            for (let i = topAuthors.length; i < 3; i++) {
                const li = document.createElement('li');
                li.textContent = `Author ${i + 1} (0 books)`;
                topAuthorsList.appendChild(li);
            }
        }

        function generateStarRating(rating) {
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5 ? 1 : 0;
            const emptyStars = 5 - fullStars - halfStar;
            let starsHTML = '';

            for (let i = 0; i < fullStars; i++) {
                starsHTML += `<span class="star">★</span>`;
            }

            if (halfStar) {
                starsHTML += `<span class="star">☆</span>`;
            }

            for (let i = 0; i < emptyStars; i++) {
                starsHTML += `<span class="star empty">☆</span>`;
            }

            return starsHTML;
        }

        function getWeekNumber(d) {
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            return weekNo;
        }

        const modal = document.getElementById('bookModal');
        const closeModalBtn = document.querySelector('.close-modal');
        const modalBookImage = document.getElementById('modal-book-image');
        const modalBookTitle = document.getElementById('modal-book-title');
        const modalBookAuthor = document.getElementById('modal-book-author');
        const modalBookDateRead = document.getElementById('modal-book-date-read');
        const modalBookRating = document.getElementById('modal-book-rating');
        const modalBookReview = document.getElementById('modal-book-review');
        const modalWorldOfBooksButton = document.getElementById('modal-world-of-books-button');
        const modalGoodreadsButton = document.getElementById('modal-goodreads-button');

        function openModal(book) {
            modalBookImage.src = book.image;
            modalBookImage.alt = book.title;
            modalBookTitle.textContent = book.title;
            modalBookAuthor.textContent = `by ${book.author || 'Unknown Author'}`;
            modalBookDateRead.textContent = book.dateRead ? `Read on: ${book.dateRead}` : 'Date Read: N/A';
            modalBookReview.textContent = book.review || 'No review available.';

            let starsHTML = '';
            if (book.rating) {
                let fullStars = '★'.repeat(book.rating);
                let emptyStars = '☆'.repeat(5 - book.rating);
                starsHTML = `
                    ${fullStars.split('').map(() => `<span class="star">★</span>`).join('')}
                    ${emptyStars.split('').map(() => `<span class="star empty">☆</span>`).join('')}
                `;
            } else {
                starsHTML = `<span class="star empty">☆</span>`.repeat(5);
            }
            modalBookRating.innerHTML = starsHTML;

            const goodreadsQuery = encodeURIComponent(book.title);
            const goodreadsSearchURL = `https://www.goodreads.com/search?q=${goodreadsQuery}`;
            modalGoodreadsButton.onclick = () => {
                window.open(goodreadsSearchURL, '_blank');
            };

            const worldOfBooksQuery = encodeURIComponent(book.title);
            const worldOfBooksSearchURL = `https://www.worldofbooks.com/en-gb/search?q=${worldOfBooksQuery}`;
            modalWorldOfBooksButton.onclick = () => {
                window.open(worldOfBooksSearchURL, '_blank');
            };

            modal.style.display = 'block';
            document.body.style.overflow = 'hidden'; 
        }

        closeModalBtn.onclick = function () {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; 
        }

        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }
    </script>
</body>
</html>
