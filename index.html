<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A personal book review website showcasing my favorite books and ratings.">
    <meta name="keywords" content="book reviews, reading, books, ratings">
    <title>My Book Reviews</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        @font-face {
            font-family: 'Roboto Mono';
            src: url('font.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }

        body {
            background-color: #f4f4f4;
            color: #333;
            font-family: 'Roboto Mono', monospace;
            text-align: center;
            margin: 0;
            padding: 20px;
        }

        h1 {
            color: #ff0000;
            margin-bottom: 20px;
        }

        #currently-reading-container {
            display: none;
            background-color: #fffbcc;
            border: 2px solid #ffcc00;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            max-width: 800px;
            margin: 0 auto 40px auto;
            padding: 20px;
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            gap: 20px;
            position: relative;
            z-index: 10;
        }

        #currently-reading-container img {
            width: 200px;
            height: auto;
            border-radius: 5px;
            object-fit: cover;
        }

        #currently-reading-details {
            text-align: left;
            flex: 1;
        }

        #currently-reading-details h2 {
            margin: 0 0 10px 0;
            font-size: 1.8em;
            color: #c01919;
        }

        #currently-reading-details .author {
            font-size: 1.1em;
            color: #555;
            margin-bottom: 10px;
        }

        #currently-reading-details .start-date {
            font-size: 1em;
            color: #777;
            margin-bottom: 15px;
        }

        #currently-reading-details .status {
            font-size: 1em;
            color: #333;
            margin-bottom: 15px;
        }

        #currently-reading-details .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-start;
        }


        #books-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 0 auto;
            max-width: 1200px;
            padding: 20px;
        }

        .book {
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: left;
            position: relative;
            display: flex;
            flex-direction: column;
            min-height: 450px;
            max-width: 350px;
            margin: 0 auto;
        }

        .book img {
            width: 100%;
            height: auto;
            aspect-ratio: 2 / 3;
            border-radius: 5px;
            object-fit: cover;
            margin-bottom: 15px;
        }

        .book h2 {
            margin: 10px 0 10px 0;
            font-size: 1.3em;
            color: #ff0000;
            height: 3em;
            overflow: hidden;
        }

        .author,
        .date-read {
            font-size: 0.95em;
            color: #c01919;
            margin-bottom: 10px;
            height: 1.2em;
            overflow: hidden;
        }

        .rating-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .rating {
            font-size: 1.2em;
            color: #ff0000;
            display: flex;
        }

        .rating .star {
            font-size: 1.3em;
            color: #ff0000;
            margin: 0 1px;
        }

        .rating .star-empty {
            color: #ddd;
        }

        .book p {
            font-size: 0.95em;
            color: #666;
            margin: 10px 0;
            flex-grow: 1;
            height: 4.5em;
            overflow: hidden;
        }

        .top-book-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ffcc00;
            color: #333;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.8em;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .footer {
            margin-top: 40px;
            font-size: 0.8em;
            color: #777;
        }

        .footer a {
            color: #ff0000;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        ::selection {
            background-color: #ff0000;
            color: #ffffff;
        }

        .search-container {
            margin-bottom: 20px;
        }

        .search-input {
            padding: 10px;
            font-size: 1em;
            width: 100%;
            max-width: 300px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .filter-container {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-container select {
            padding: 10px;
            font-size: 1em;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .filter-container button {
            padding: 10px 15px;
            font-size: 1em;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            background-color: #f4f4f4;
            transition: background-color 0.3s;
        }

        .filter-container button.active {
            background-color: #ddd;
        }

        .filter-container button.want-to-read-active {
            background-color: #ffcc00;
            color: #333;
        }

        .pagination {
            margin: 20px 0;
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .pagination button {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f4f4f4;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .pagination button.active,
        .pagination button:hover {
            background-color: #ddd;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .world-of-books-button,
        .goodreads-button {
            padding: 10px 12px;
            background-color: #ffcc00;
            color: #333;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            transition: background-color 0.3s;
            flex: 1;
            text-align: center;
        }

        .world-of-books-button:hover,
        .goodreads-button:hover {
            background-color: #e6b800;
        }

        @media (max-width: 767px) {
            .filter-container {
                flex-direction: column;
            }

            .filter-container select,
            .filter-container button {
                width: 100%;
                max-width: 300px;
            }

            .action-buttons {
                flex-direction: column;
            }

            #books-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .book {
                max-width: none;
                min-height: auto;
            }

            #currently-reading-container {
                flex-direction: column;
                max-width: 100%;
                align-items: center;
            }

            #currently-reading-container img {
                width: 100%;
                max-width: 200px;
            }

            #currently-reading-details {
                text-align: center;
            }

            #currently-reading-details .action-buttons {
                justify-content: center;
            }
        }


        @media (max-width: 480px) {
            #books-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <h1>The Books I Have Read</h1>

    <div id="currently-reading-container">
        <img src="" alt="Currently Reading Book" id="currently-reading-image">
        <div id="currently-reading-details">
            <h2 id="currently-reading-title">Book Title</h2>
            <div class="author" id="currently-reading-author">by Author Name</div>
            <div class="start-date" id="currently-reading-start-date">Started on: YYYY-MM-DD</div>
            <div class="status">In Progress</div>
            <div class="action-buttons">
                <button class="world-of-books-button" id="current-world-of-books-button">View on World of Books</button>
                <button class="goodreads-button" id="current-goodreads-button">Show on Goodreads</button>
            </div>
        </div>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Search for books, authors, or dates...">
    </div>

    <div class="filter-container">
        <select id="sortBy">
            <option value="title">Sort by Title</option>
            <option value="author">Sort by Author</option>
            <option value="dateRead" selected>Sort by Date Read</option>
            <option value="rating">Sort by Rating</option>
        </select>

        <button id="toggleSortOrder">Toggle Asc/Desc</button>
        <button id="toggleView" class="active">My Want to Read</button>
    </div>

    <div id="books-container">
    </div>

    <div class="pagination" id="pagination-container">
    </div>

    <div class="footer">
        <p>V.1.1<br>Soon available on GitHub.</p>
    </div>

    <script>
        let sortDescending = true;
        let currentPage = 1;
        const booksPerPage = 20;
        let allBooksRead = [];
        let allBooksWantToRead = [];
        let currentView = 'read';
        let currentSortBy = 'dateRead';
        let currentSortOrder = 'desc';

        let currentlyReading = null;

        const readBooksURL = '';
        const wantToReadBooksURL = '';
        const currentlyReadingURL = '';

        const fetchReadBooks = () => {
            fetch(readBooksURL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok for read books.');
                    }
                    return response.json();
                })
                .then(books => {
                    allBooksRead = books;
                    applySort();
                })
                .catch(error => console.error('Error fetching read books:', error));
        };

        const fetchWantToReadBooks = () => {
            fetch(wantToReadBooksURL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok for want to read books.');
                    }
                    return response.json();
                })
                .then(books => {
                    allBooksWantToRead = books;
                    if (currentView === 'wantToRead') {
                        applySort();
                    }
                })
                .catch(error => console.error('Error fetching want to read books:', error));
        };

        const fetchCurrentlyReading = () => {
            fetch(currentlyReadingURL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok for currently reading book.');
                    }
                    return response.json();
                })
                .then(book => {
                    currentlyReading = book;
                    displayCurrentlyReading();
                })
                .catch(error => {
                    console.error('Error fetching currently reading book:', error);
                    document.getElementById('currently-reading-container').style.display = 'none';
                });
        };

        const displayCurrentlyReading = () => {
            if (!currentlyReading || !currentlyReading.title) {
                document.getElementById('currently-reading-container').style.display = 'none';
                return;
            }

            const container = document.getElementById('currently-reading-container');
            container.style.display = 'flex';

            document.getElementById('currently-reading-image').src = currentlyReading.image;
            document.getElementById('currently-reading-image').alt = currentlyReading.title;
            document.getElementById('currently-reading-title').textContent = currentlyReading.title;
            document.getElementById('currently-reading-author').textContent = `by ${currentlyReading.author}`;
            document.getElementById('currently-reading-start-date').textContent = `Started on: ${currentlyReading.startDate}`;

            const goodreadsQuery = encodeURIComponent(currentlyReading.title);
            const goodreadsSearchURL = `https://www.goodreads.com/search?q=${goodreadsQuery}`;
            const goodreadsButton = document.getElementById('current-goodreads-button');
            goodreadsButton.addEventListener('click', () => {
                window.open(goodreadsSearchURL, '_blank');
            });

            const worldOfBooksQuery = encodeURIComponent(currentlyReading.title);
            const worldOfBooksSearchURL = `https://www.worldofbooks.com/en-gb/search?q=${worldOfBooksQuery}`;
            const worldOfBooksButton = document.getElementById('current-world-of-books-button');
            worldOfBooksButton.addEventListener('click', () => {
                window.open(worldOfBooksSearchURL, '_blank');
            });
        };

        const displayBooks = (books, view) => {
            const booksContainer = document.getElementById('books-container');
            booksContainer.innerHTML = '';

            const start = (currentPage - 1) * booksPerPage;
            const end = start + booksPerPage;
            const paginatedBooks = books.slice(start, end);

            paginatedBooks.forEach(book => {
                const bookElement = document.createElement('div');
                bookElement.className = 'book';

                let reviewContent = '';
                let authorContent = '';
                let dateReadContent = '';

                if (view === 'read') {
                    reviewContent = book.review ? `<p>${book.review}</p>` : '<p>&nbsp;</p>';
                    authorContent = book.author ? `<div class="author">by ${book.author}</div>` : '<div class="author">&nbsp;</div>';
                    dateReadContent = book.dateRead ? `<div class="date-read">Read on: ${book.dateRead}</div>` : '<div class="date-read">&nbsp;</div>';
                } else {
                    authorContent = book.author ? `<div class="author">by ${book.author}</div>` : '<div class="author">&nbsp;</div>';
                    dateReadContent = '<div class="date-read">&nbsp;</div>';
                    reviewContent = '<p>&nbsp;</p>';
                }

                let starsHTML = '';
                if (view === 'read') {
                    let fullStars = '★'.repeat(book.rating);
                    let emptyStars = '☆'.repeat(5 - book.rating);
                    starsHTML = `
                        <div class="rating">
                            ${fullStars.split('').map(() => `<span class="star">★</span>`).join('')}
                            ${emptyStars.split('').map(() => `<span class="star star-empty">☆</span>`).join('')}
                        </div>
                    `;
                } else {
                    starsHTML = `<div class="rating" style="height: 1.2em;"></div>`;
                }

                const actionButtonsDiv = document.createElement('div');
                actionButtonsDiv.className = 'action-buttons';

                const goodreadsButton = document.createElement('button');
                goodreadsButton.className = 'goodreads-button';
                goodreadsButton.textContent = 'Show on Goodreads';
                const goodreadsQuery = encodeURIComponent(book.title);
                const goodreadsSearchURL = `https://www.goodreads.com/search?q=${goodreadsQuery}`;
                goodreadsButton.addEventListener('click', () => {
                    window.open(goodreadsSearchURL, '_blank');
                });

                const worldOfBooksButton = document.createElement('button');
                worldOfBooksButton.className = 'world-of-books-button';
                worldOfBooksButton.textContent = 'View on World of Books';
                const worldOfBooksQuery = encodeURIComponent(book.title);
                const worldOfBooksSearchURL = `https://www.worldofbooks.com/en-gb/search?q=${worldOfBooksQuery}`;
                worldOfBooksButton.addEventListener('click', () => {
                    window.open(worldOfBooksSearchURL, '_blank');
                });

                actionButtonsDiv.appendChild(worldOfBooksButton);
                actionButtonsDiv.appendChild(goodreadsButton);

                bookElement.innerHTML = `
                    <img src="${book.image}" alt="${book.title}">
                    <h2>${book.title}</h2>
                    ${authorContent}
                    ${dateReadContent}
                    ${starsHTML}
                    ${reviewContent}
                `;

                bookElement.appendChild(actionButtonsDiv);
                booksContainer.appendChild(bookElement);
            });

            updatePagination(books.length);
            adjustBookContainerLayout();
            window.scrollTo(0, 0);
        };

        const updatePagination = (totalBooks) => {
            const paginationContainer = document.getElementById('pagination-container');
            paginationContainer.innerHTML = '';

            const totalPages = Math.ceil(totalBooks / booksPerPage);

            for (let i = 1; i <= totalPages; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                button.className = i === currentPage ? 'active' : '';
                button.addEventListener('click', () => {
                    currentPage = i;
                    updateHash();
                    applySort();
                });
                paginationContainer.appendChild(button);
            }
        };

        const applySort = () => {
            let books = currentView === 'read' ? allBooksRead : allBooksWantToRead;

            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const sortBy = currentSortBy;
            const sortOrder = currentSortOrder;

            let filteredBooks = books.filter(book => {
                const title = book.title.toLowerCase();
                const author = book.author ? book.author.toLowerCase() : '';
                const dateRead = book.dateRead ? book.dateRead.toLowerCase() : '';

                let matchesSearch = title.includes(searchTerm) || author.includes(searchTerm) || dateRead.includes(searchTerm);
                return matchesSearch;
            });

            filteredBooks.sort((a, b) => {
                let aValue, bValue;

                if (sortBy === 'title') {
                    aValue = a.title.toLowerCase();
                    bValue = b.title.toLowerCase();
                } else if (sortBy === 'author') {
                    aValue = a.author ? a.author.toLowerCase() : '';
                    bValue = b.author ? b.author.toLowerCase() : '';
                } else if (sortBy === 'dateRead') {
                    aValue = a.dateRead ? new Date(a.dateRead) : new Date(0);
                    bValue = b.dateRead ? new Date(b.dateRead) : new Date(0);
                } else if (sortBy === 'rating') {
                    aValue = a.rating;
                    bValue = b.rating;
                }

                if (sortBy === 'dateRead') {
                    if (aValue < bValue) return sortOrder === 'desc' ? 1 : -1;
                    if (aValue > bValue) return sortOrder === 'desc' ? -1 : 1;
                } else if (sortBy === 'rating') {
                    if (aValue < bValue) return sortOrder === 'desc' ? 1 : -1;
                    if (aValue > bValue) return sortOrder === 'desc' ? -1 : 1;
                } else {
                    if (aValue < bValue) return sortOrder === 'desc' ? 1 : -1;
                    if (aValue > bValue) return sortOrder === 'desc' ? -1 : 1;
                }
                return 0;
            });

            displayBooks(filteredBooks, currentView);
        };

        document.getElementById('searchInput').addEventListener('input', function () {
            currentPage = 1;
            updateHash();
            applySort();
        });

        document.getElementById('sortBy').addEventListener('change', function () {
            currentSortBy = this.value;
            currentPage = 1;
            updateHash();
            applySort();
            window.scrollTo(0, 0);
        });

        document.getElementById('toggleSortOrder').addEventListener('click', function () {
            sortDescending = !sortDescending;
            currentSortOrder = sortDescending ? 'desc' : 'asc';
            this.textContent = `Sort Order: ${sortDescending ? 'Desc' : 'Asc'}`;
            this.classList.toggle('active', sortDescending);
            currentPage = 1;
            updateHash();
            applySort();
            window.scrollTo(0, 0);
        });

        document.getElementById('toggleView').addEventListener('click', function () {
            currentView = currentView === 'read' ? 'wantToRead' : 'read';
            this.textContent = currentView === 'read' ? 'My Want to Read' : 'My Read Books';
            this.classList.toggle('want-to-read-active', currentView === 'wantToRead');
            currentPage = 1;
            updateHash();
            applySort();
        });

        const adjustBookContainerLayout = () => {
            const booksContainer = document.getElementById('books-container');
            const displayedBooks = booksContainer.children.length;

            if (displayedBooks === 1) {
                booksContainer.style.justifyItems = 'center';
            } else {
                booksContainer.style.justifyItems = 'stretch';
            }
        };

        const initializeCurrentlyReading = () => {
            fetchCurrentlyReading();
        };


        const parseHash = () => {
            const hash = window.location.hash.substring(1); 
            const params = new URLSearchParams(hash);


            const view = params.get('view');
            const page = parseInt(params.get('page'), 10);
            const sortBy = params.get('sortBy');
            const sortOrder = params.get('sortOrder');


            if (view && (view === 'read' || view === 'wantToRead')) {
                currentView = view;
                document.getElementById('toggleView').textContent = currentView === 'read' ? 'My Want to Read' : 'My Read Books';
                document.getElementById('toggleView').classList.toggle('want-to-read-active', currentView === 'wantToRead');
            }


            if (!isNaN(page) && page > 0) {
                currentPage = page;
            }


            if (sortBy && ['title', 'author', 'dateRead', 'rating'].includes(sortBy)) {
                currentSortBy = sortBy;
                document.getElementById('sortBy').value = sortBy;
            }


            if (sortOrder && ['asc', 'desc'].includes(sortOrder)) {
                currentSortOrder = sortOrder;
                sortDescending = sortOrder === 'desc';
                document.getElementById('toggleSortOrder').textContent = `Sort Order: ${sortDescending ? 'Desc' : 'Asc'}`;
                document.getElementById('toggleSortOrder').classList.toggle('active', sortDescending);
            } else {

                document.getElementById('toggleSortOrder').textContent = `Sort Order: ${sortDescending ? 'Desc' : 'Asc'}`;
            }
        };


        const updateHash = () => {
            const params = new URLSearchParams();
            params.set('view', currentView);
            params.set('page', currentPage);
            params.set('sortBy', currentSortBy);
            params.set('sortOrder', currentSortOrder);
            window.location.hash = params.toString();
        };


        window.addEventListener('hashchange', () => {
            parseHash();
            applySort();
        });

        const initializePage = () => {
            initializeCurrentlyReading();
            fetchReadBooks();
            fetchWantToReadBooks();
            parseHash();
        };

        
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>

</html>
